let quizData = []; async function loadQuizData(category) { const fileMap = { 'math': 'data/math.json', 'thai': 'data/thai.json', 'law': 'data/law.json', 'english': 'data/english.json' }; const filesToLoad = []; if (category === 'all') { filesToLoad.push(...Object.values(fileMap)); } else if (category === 'thai_math') { filesToLoad.push(fileMap.math, fileMap.thai); } else { filesToLoad.push(fileMap[category]); } console.log('üìÇ Loading category:', category, 'Files:', filesToLoad); try { const results = await Promise.all(filesToLoad.map(async file => { console.log('üì° Fetching:', file); const res = await fetch(file); if (!res.ok) { console.error('‚ùå Failed to load:', file, 'Status:', res.status); throw new Error(`Could not load ${file} (Status: ${res.status})`); } return res.json(); })); quizData = results.flat(); console.log('‚úÖ Data loaded successfully. Total questions:', quizData.length); return true; } catch (error) { console.error('üö´ Error loading quiz data:', error); alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö:\n${error.message}\n\n‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö`); return false; } } let activeQuestions = []; let currentQuestionIndex = 0; let score = 0; let wrongAnswers = []; let skippedQuestionIndices = []; let startTime; const QUIZ_STORAGE_KEY = 'ocsc_quiz_progress_v1'; const subCategoryIcons = { "‡∏≠‡∏ô‡∏∏‡∏Å‡∏£‡∏°": "üî¢", "‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå": "‚ûï", "‡πÇ‡∏≠‡πÄ‡∏õ‡∏≠‡πÄ‡∏£‡∏ä‡∏±‡πà‡∏ô": "‚öôÔ∏è", "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á": "üìä", "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå": "üî£", "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤": "üìë", "‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ": "üî§", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤": "üìñ", "‡∏≠‡∏∏‡∏õ‡∏°‡∏≤‡∏≠‡∏∏‡∏õ‡πÑ‡∏°‡∏¢": "üí°", "‡∏û.‡∏£.‡∏ö ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô": "üèõÔ∏è", "‡∏û ‡∏£ ‡∏è ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ": "üè†", "‡∏û‡∏£‡∏ö ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á": "‚öñÔ∏è", "‡∏û‡∏£‡∏ö ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà": "üõ°Ô∏è", "‡∏û‡∏£‡∏ö ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°": "ü§ù", "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≤‡∏ç‡∏≤": "‚öñÔ∏è", "‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": "üÖ∞Ô∏è", "‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": "üìù", "‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": "üí¨", "‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©": "üìñ" }; function saveProgress() { if (!activeQuestions.length) return; const payload = { activeQuestions, currentQuestionIndex, score, wrongAnswers, skippedQuestionIndices, startTime: startTime || Date.now() }; localStorage.setItem(QUIZ_STORAGE_KEY, JSON.stringify(payload)); } function loadSavedProgress() { const raw = localStorage.getItem(QUIZ_STORAGE_KEY); if (!raw) return null; try { const data = JSON.parse(raw); const isValid = Array.isArray(data.activeQuestions) && Number.isInteger(data.currentQuestionIndex) && typeof data.score === 'number' && Array.isArray(data.wrongAnswers); if (!isValid) return null; if (!Array.isArray(data.skippedQuestionIndices)) { data.skippedQuestionIndices = []; } if (data.startTime) { startTime = data.startTime; } return data; } catch (error) { return null; } } function clearSavedProgress() { localStorage.removeItem(QUIZ_STORAGE_KEY); } function resumeSavedQuiz() { const saved = loadSavedProgress(); if (!saved) return; activeQuestions = saved.activeQuestions; currentQuestionIndex = Math.max(0, saved.currentQuestionIndex); score = saved.score; wrongAnswers = saved.wrongAnswers; skippedQuestionIndices = [...new Set(saved.skippedQuestionIndices)].filter(i => Number.isInteger(i) && i >= 0 && i < saved.activeQuestions.length); if (!activeQuestions.length) { clearSavedProgress(); initCategorySelection(); return; } document.getElementById('quiz-container').classList.remove('hidden'); document.getElementById('result-screen').classList.add('hidden'); document.getElementById('progress').classList.remove('hidden'); if (currentQuestionIndex >= activeQuestions.length) { showResult(); return; } loadQuiz(); } function discardSavedQuiz() { clearSavedProgress(); initCategorySelection(); } function showFeedback(message, isCorrect) { const feedbackOverlay = document.createElement('div'); feedbackOverlay.className = `feedback-overlay ${isCorrect ? 'feedback-correct' : 'feedback-wrong'}`; feedbackOverlay.innerHTML = `<div class="text-4xl mb-2 font-bold">${isCorrect ? '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!' : '‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡∏ö...'}</div><div class="text-xl">${message}</div>`; document.body.appendChild(feedbackOverlay); setTimeout(() => { feedbackOverlay.classList.add('opacity-0'); setTimeout(() => feedbackOverlay.remove(), 400); }, 1000); } function initCategorySelection() { const container = document.getElementById('quiz-container'); const resultScreen = document.getElementById('result-screen'); const progress = document.getElementById('progress'); const subLabel = document.getElementById('sub-category-label'); const saved = loadSavedProgress(); container.classList.remove('hidden'); progress.classList.add('hidden'); resultScreen.classList.add('hidden'); subLabel.innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô"; container.innerHTML = ` ${saved ? `<div class="mb-6 p-4 md:p-5 rounded-2xl border border-blue-200 bg-gradient-to-r from-blue-50 to-cyan-50"><div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3"><div><h3 class="font-bold text-slate-800">‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà</h3><p class="text-sm text-slate-600">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${saved.currentQuestionIndex + 1}/${saved.activeQuestions.length}‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p></div><div class="flex flex-col sm:flex-row gap-2"><button onclick="resumeSavedQuiz()" class="px-4 py-2 rounded-xl bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700 transition-colors">‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á</button><button onclick="discardSavedQuiz()" class="px-4 py-2 rounded-xl bg-white border border-slate-200 text-slate-600 text-sm font-semibold hover:bg-slate-50 transition-colors">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πâ‡∏≤‡∏á</button></div></div></div>` : ''}<div class="category-grid pt-4 animate-in fade-in slide-in-from-bottom-4 duration-700"><button onclick="showSubCategories('thai_math')" class="category-card group"><div class="icon-box group-hover:bg-blue-600 group-hover:text-white transition-colors">üìò</div><div><h3>1. ‡πÑ‡∏ó‡∏¢+‡∏Ñ‡∏ì‡∏¥‡∏ï</h3><p>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ó‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏≤,‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ,‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï,‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á,‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏†‡∏≤‡∏©‡∏≤,‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</p></div></button><button onclick="showSubCategories('law')" class="category-card group"><div class="icon-box group-hover:bg-amber-600 group-hover:text-white transition-colors">‚öñÔ∏è</div><div><h3>2. ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</h3><p>‡∏û.‡∏£.‡∏ö. ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô,‡∏û.‡∏£.‡∏é. ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ,‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Ø ‡πÅ‡∏•‡∏∞‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≤‡∏ç‡∏≤</p></div></button><button onclick="showSubCategories('english')" class="category-card group"><div class="icon-box group-hover:bg-orange-600 group-hover:text-white transition-colors">üá¨üáß</div><div><h3>3. ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</h3><p>Vocabulary,Grammar,Conversation,Reading</p></div></button><button onclick="startQuiz('all')" class="category-card group border-blue-200 bg-blue-50/50"><div class="icon-box bg-blue-600 text-white">üåü</div><div><h3>‡∏™‡∏∏‡πà‡∏°‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î</h3><p>‡∏Ñ‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏°‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p></div></button></div>`; } function showSubCategories(mainCategory) { console.log('showSubCategories called with:', mainCategory); const container = document.getElementById('quiz-container'); const subLabel = document.getElementById('sub-category-label'); const mathSub = ["‡∏≠‡∏ô‡∏∏‡∏Å‡∏£‡∏°", "‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡πÇ‡∏≠‡πÄ‡∏õ‡∏≠‡πÄ‡∏£‡∏ä‡∏±‡πà‡∏ô", "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á", "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå"]; const thaiSub = ["‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤", "‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤", "‡∏≠‡∏∏‡∏õ‡∏°‡∏≤‡∏≠‡∏∏‡∏õ‡πÑ‡∏°‡∏¢"]; const lawSub = ["‡∏û.‡∏£.‡∏ö ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô", "‡∏û ‡∏£ ‡∏è ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ", "‡∏û‡∏£‡∏ö ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á", "‡∏û‡∏£‡∏ö ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà", "‡∏û‡∏£‡∏ö ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°", "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≤‡∏ç‡∏≤"]; const engSub = ["‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"]; let subs = []; let title = ""; if (mainCategory === 'thai_math') { subs = [...mathSub, ...thaiSub]; title = "‡πÑ‡∏ó‡∏¢+‡∏Ñ‡∏ì‡∏¥‡∏ï"; } else if (mainCategory === 'law') { subs = lawSub; title = "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢"; } else if (mainCategory === 'english') { subs = engSub; title = "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"; } subLabel.innerText = `${title}:‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢`; let html = `<div class="mb-6"><button onclick="initCategorySelection()" class="inline-flex items-center gap-1.5 px-2 py-1 rounded-full bg-white border border-slate-200 text-slate-500 text-[10px] font-semibold hover:bg-blue-50 hover:text-blue-600 hover:border-blue-200 transition-all shadow-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div><div class="category-grid animate-in fade-in slide-in-from-bottom-4 duration-700">`; console.log('Rendering subcategories:', subs); subs.forEach(sub => { html += `<button onclick="startQuiz('${mainCategory}','${sub}')" class="category-card group"><div class="icon-box group-hover:bg-blue-600 group-hover:text-white transition-colors">${subCategoryIcons[sub] || 'üìù'}</div><div><h3 class="text-sm">${sub}</h3></div></button>`; }); html += `</div>`; container.innerHTML = html; } async function startQuiz(mainCategory, subCategory = null) { let fileKey = mainCategory; if (mainCategory === 'thai_math' && subCategory) { const mathSub = ["‡∏≠‡∏ô‡∏∏‡∏Å‡∏£‡∏°", "‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡πÇ‡∏≠‡πÄ‡∏õ‡∏≠‡πÄ‡∏£‡∏ä‡∏±‡πà‡∏ô", "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á", "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå"]; fileKey = mathSub.includes(subCategory) ? 'math' : 'thai'; } const container = document.getElementById('quiz-container'); container.innerHTML = `<div class="text-center py-20 animate-pulse"><div class="text-4xl mb-4">‚è≥</div><p class="text-slate-500 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö...</p></div>`; const success = await loadQuizData(fileKey); if (!success) { initCategorySelection(); return; } let filtered = []; if (mainCategory === 'all') { filtered = [...quizData]; } else if (subCategory) { filtered = quizData.filter(q => q.category === subCategory); } else { const mathSub = ["‡∏≠‡∏ô‡∏∏‡∏Å‡∏£‡∏°", "‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡πÇ‡∏≠‡πÄ‡∏õ‡∏≠‡πÄ‡∏£‡∏ä‡∏±‡πà‡∏ô", "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á", "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå"]; const thaiSub = ["‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤", "‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤", "‡∏≠‡∏∏‡∏õ‡∏°‡∏≤‡∏≠‡∏∏‡∏õ‡πÑ‡∏°‡∏¢"]; const lawSub = ["‡∏û.‡∏£.‡∏ö ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô", "‡∏û ‡∏£ ‡∏è ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ", "‡∏û‡∏£‡∏ö ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á", "‡∏û‡∏£‡∏ö ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà", "‡∏û‡∏£‡∏ö ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°", "‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≤‡∏ç‡∏≤"]; const engSub = ["‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"]; if (mainCategory === 'thai_math') { const thaiMathSub = [...mathSub, ...thaiSub]; filtered = quizData.filter(q => thaiMathSub.includes(q.category)); } else if (mainCategory === 'law') filtered = quizData.filter(q => lawSub.includes(q.category)); else if (mainCategory === 'english') filtered = quizData.filter(q => engSub.includes(q.category)); } if (filtered.length === 0) { alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ"); initCategorySelection(); return; } filtered.sort(() => Math.random() - 0.5); if (mainCategory === 'all' || filtered.length > 100) { activeQuestions = filtered.slice(0, 100); } else { activeQuestions = filtered; } currentQuestionIndex = 0; score = 0; wrongAnswers = []; skippedQuestionIndices = []; startTime = Date.now(); clearSavedProgress(); document.getElementById('progress').classList.remove('hidden'); saveProgress(); loadQuiz(); } function loadQuiz() { const currentData = activeQuestions[currentQuestionIndex]; const container = document.getElementById('quiz-container'); const subLabel = document.getElementById('sub-category-label'); const progress = document.getElementById('progress'); subLabel.innerText = `‡∏´‡∏°‡∏ß‡∏î:${currentData.category}`; progress.innerText = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentQuestionIndex + 1}/${activeQuestions.length}`; const formattedQuestion = parseMarkdownTable(currentData.question); container.innerHTML = `<div class="animate-in fade-in duration-500"><div class="text-xl text-slate-700 leading-relaxed font-semibold mb-6">${formattedQuestion}</div>${currentData.hint ? `<button onclick="toggleHint()" class="hint-btn"><svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.674a1 1 0 00.922-.606l7-15A1 1 0 0021.332 0H2.668a1 1 0 00-.927 1.394l7 15a1 1 0 00.922.606zM12 22a4 4 0 110-8 4 4 0 010 8z"/></svg>‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</button><div id="hint-box" class="hint-box"><strong>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</strong>${currentData.hint}</div>` : ''}<div id="options-container" class="space-y-4"></div><div class="mt-8 flex flex-col sm:flex-row items-stretch sm:items-center gap-3"><button id="skip-question-btn" class="flex-1 px-4 py-3 rounded-xl bg-amber-50 border border-amber-200 text-amber-700 font-semibold hover:bg-amber-100 transition-colors">‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ</button><button id="save-exit-btn" class="px-4 py-3 rounded-xl bg-slate-100 border border-slate-200 text-slate-700 font-semibold hover:bg-slate-200 transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÅ‡∏•‡∏∞ ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î</button></div><p class="mt-3 text-xs md:text-sm text-slate-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ</p><div id="skipped-list-container" class="mt-4 p-4 rounded-2xl border border-slate-200 bg-slate-50"></div></div>`; const optionsContainer = document.getElementById('options-container'); currentData.options.forEach((option, index) => { const button = document.createElement('button'); button.className = "choice-btn"; button.innerHTML = `<span class="choice-number">${index + 1}</span><span>${option}</span>`; button.onclick = () => checkAnswer(index); optionsContainer.appendChild(button); }); const skipBtn = document.getElementById('skip-question-btn'); if (skipBtn) skipBtn.onclick = skipQuestion; const saveExitBtn = document.getElementById('save-exit-btn'); if (saveExitBtn) { saveExitBtn.onclick = () => { saveProgress(); initCategorySelection(); }; } const skippedContainer = document.getElementById('skipped-list-container'); if (skippedQuestionIndices.length > 0) { skippedContainer.innerHTML = `<p class="text-sm font-semibold text-slate-700 mb-3">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ß‡πâ(‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥)</p><div class="flex flex-wrap gap-2" id="skipped-buttons-wrap"></div>`; const wrap = document.getElementById('skipped-buttons-wrap'); skippedQuestionIndices.forEach((questionIdx) => { const button = document.createElement('button'); button.className = "px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-sm font-semibold hover:bg-amber-50 transition-colors"; button.innerText = `‡∏Ç‡πâ‡∏≠ ${questionIdx + 1}`; button.onclick = () => goToSkippedQuestion(questionIdx); wrap.appendChild(button); }); } else { skippedContainer.innerHTML = `<p class="text-sm text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ß‡πâ</p>`; } saveProgress(); } function removeSkippedIndex(indexToRemove) { skippedQuestionIndices = skippedQuestionIndices.filter(i => i !== indexToRemove); } function goToSkippedQuestion(questionIndex) { if (!Number.isInteger(questionIndex)) return; if (questionIndex < 0 || questionIndex >= activeQuestions.length) return; currentQuestionIndex = questionIndex; saveProgress(); loadQuiz(); } function goToNextQuestionOrResult() { if (currentQuestionIndex < activeQuestions.length) { saveProgress(); loadQuiz(); return; } if (skippedQuestionIndices.length > 0) { currentQuestionIndex = skippedQuestionIndices[0]; saveProgress(); loadQuiz(); return; } showResult(); } function skipQuestion() { if (!skippedQuestionIndices.includes(currentQuestionIndex)) { skippedQuestionIndices.push(currentQuestionIndex); } currentQuestionIndex++; goToNextQuestionOrResult(); } function checkAnswer(selectedIndex) { removeSkippedIndex(currentQuestionIndex); const currentData = activeQuestions[currentQuestionIndex]; const correct = currentData.answer - 1; const buttons = document.querySelectorAll('.choice-btn'); buttons.forEach(btn => btn.disabled = true); if (selectedIndex === correct) { score++; buttons[selectedIndex].classList.add('correct-choice'); showFeedback("‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!", true); } else { buttons[selectedIndex].classList.add('wrong-choice'); buttons[correct].classList.add('hint-choice'); wrongAnswers.push({ question: currentData.question, yourAnswer: currentData.options[selectedIndex], correctAnswer: currentData.options[correct], explanation: currentData.explanation, category: currentData.category }); showFeedback("‡πÑ‡∏ß‡πâ‡πÅ‡∏Å‡πâ‡∏ï‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞", false); } setTimeout(() => { currentQuestionIndex++; goToNextQuestionOrResult(); }, 1400); } function showResult() { const container = document.getElementById('quiz-container'); const resultScreen = document.getElementById('result-screen'); const subLabel = document.getElementById('sub-category-label'); container.classList.add('hidden'); resultScreen.classList.remove('hidden'); clearSavedProgress(); skippedQuestionIndices = []; subLabel.innerText = "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö"; let reviewHTML = `<div class="text-center mb-10 p-6 bg-blue-50 rounded-3xl border border-blue-100"><div class="text-5xl font-black text-blue-600 mb-2">${score}/${activeQuestions.length}</div><div class="text-slate-500 font-medium">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ</div><button onclick="location.reload()" class="mt-6 bg-blue-600 text-white px-8 py-3 rounded-2xl font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô</button></div>`; if (wrongAnswers.length > 0) { reviewHTML += `<h3 class="text-xl font-bold text-slate-800 mb-6">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>`; wrongAnswers.forEach((item) => { reviewHTML += `<div class="review-card"><span class="review-badge badge-wrong">${item.category}</span><p class="font-bold text-slate-700 mb-4">${item.question}</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div class="p-3 rounded-xl bg-red-50 text-red-700 text-sm"><strong>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</strong>${item.yourAnswer}</div><div class="p-3 rounded-xl bg-emerald-50 text-emerald-700 text-sm"><strong>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å:</strong>${item.correctAnswer}</div></div><div class="p-4 rounded-2xl bg-slate-100 text-slate-600 text-sm italic"><strong>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:</strong>${item.explanation}</div></div>`; }); } else { reviewHTML += `<div class="text-center py-10"><div class="text-6xl mb-4">üëë</div><h3 class="text-2xl font-bold text-slate-800">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!</h3><p class="text-slate-500">‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô!</p></div>`; } resultScreen.innerHTML = reviewHTML; saveToHistory(); } function saveToHistory() { const endTime = Date.now(); const durationMs = endTime - (startTime || endTime); const durationSeconds = Math.floor(durationMs / 1000); const dateStr = new Date().toLocaleString('th-TH'); const result = { score: score, total: activeQuestions.length, duration: durationSeconds, date: dateStr, timestamp: endTime }; let history = JSON.parse(localStorage.getItem('quizHistory') || '[]'); history.unshift(result); if (history.length > 20) { history = history.slice(0, 20); } localStorage.setItem('quizHistory', JSON.stringify(history)); } window.onload = async () => { initCategorySelection(); const homeBtn = document.getElementById('home-btn'); if (homeBtn) { homeBtn.addEventListener('click', () => location.reload()); } }; function toggleHint() { const hintBox = document.getElementById('hint-box'); if (hintBox) { const isHidden = window.getComputedStyle(hintBox).display === 'none'; hintBox.style.display = isHidden ? 'block' : 'none'; const btn = document.querySelector('.hint-btn'); if (btn) { btn.innerHTML = isHidden ? `<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18"/></svg>‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ ` : `<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.674a1 1 0 00.922-.606l7-15A1 1 0 0021.332 0H2.668a1 1 0 00-.927 1.394l7 15a1 1 0 00.922.606zM12 22a4 4 0 110-8 4 4 0 010 8z"/></svg>‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ `; } } } window.initCategorySelection = initCategorySelection; window.showSubCategories = showSubCategories; window.startQuiz = startQuiz; window.resumeSavedQuiz = resumeSavedQuiz; window.discardSavedQuiz = discardSavedQuiz; window.goToSkippedQuestion = goToSkippedQuestion; window.toggleHint = toggleHint; function parseMarkdownTable(text) { if (!text.includes('|') || !text.includes('\n')) return text; const lines = text.split('\n'); let tableHtml = '<div class="quiz-table-container"><table class="quiz-table">'; let hasHeader = false; let mainTextBefore = []; let mainTextAfter = []; let inTable = false; lines.forEach(line => { const trimmed = line.trim(); if (trimmed.startsWith('|') && (trimmed.endsWith('|') || trimmed.includes('|'))) { inTable = true; const cells = trimmed.split('|').filter((c, i, arr) => { return (i > 0 && i < arr.length - 1); }); if (cells.length === 0) return; if (trimmed.includes('---')) return; if (!hasHeader) { tableHtml += '<thead><tr>' + cells.map(c => `<th>${c.trim()}</th>`).join('') + '</tr></thead><tbody>'; hasHeader = true; } else { tableHtml += '<tr>' + cells.map(c => `<td>${c.trim()}</td>`).join('') + '</tr>'; } } else if (trimmed === "" && inTable) { inTable = false; } else { if (!hasHeader) mainTextBefore.push(line); else mainTextAfter.push(line); } }); tableHtml += '</tbody></table></div>'; const before = mainTextBefore.filter(l => l.trim() !== "").join('<br>'); const after = mainTextAfter.filter(l => l.trim() !== "").join('<br>'); return (before ? before + '<br>' : '') + tableHtml + (after ? '<br>' + after : ''); }